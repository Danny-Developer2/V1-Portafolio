import{a as O,b as g,c as L,d as N,e as D,f as P,g as G,k as oe,l as H,n as V}from"./chunk-EZXKPUDW.js";import{$ as Q,B as Y,Ba as E,C as l,F as c,G as y,H as I,Ja as j,K as d,La as w,Ma as ne,N as p,Na as ae,P as u,Q as Z,R as ee,S as n,T as o,U as f,W as U,X as K,Y as te,_ as s,a as T,d as X,da as W,m as C,n as k,oa as ie,p as R,q as x,qa as M,ra as S,ya as _,za as re}from"./chunk-QP2BZZD3.js";var v=class extends Error{};v.prototype.name="InvalidTokenError";function pe(i){return decodeURIComponent(atob(i).replace(/(.)/g,(e,t)=>{let r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function de(i){let e=i.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return pe(e)}catch{return atob(e)}}function se(i,e){if(typeof i!="string")throw new v("Invalid token specified: must be a string");e||(e={});let t=e.header===!0?0:1,r=i.split(".")[t];if(typeof r!="string")throw new v(`Invalid token specified: missing part #${t+1}`);let a;try{a=de(r)}catch(m){throw new v(`Invalid token specified: invalid base64 for part #${t+1} (${m.message})`)}try{return JSON.parse(a)}catch(m){throw new v(`Invalid token specified: invalid json for part #${t+1} (${m.message})`)}}var F=class i{constructor(e){this.http=e}tokeTimeValidator="";Role="";baseUrl=`${w.apiUrl}Auth/read-token-data`;setExpToken(e){return console.log(e),new Promise((t,r)=>{this.http.post(this.baseUrl,{token:e},{withCredentials:!0}).subscribe({next:a=>{if(a.dencryptedToken)try{let m=se(a.dencryptedToken);this.tokeTimeValidator=m.exp,this.Role=m["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"],sessionStorage.setItem("role",this.Role),localStorage.setItem("expirationTime",this.tokeTimeValidator.toString()),localStorage.setItem("token",e),sessionStorage.setItem("expirationTime",this.tokeTimeValidator.toString());let b=new Date().getTime(),ce=parseInt(this.tokeTimeValidator,10)*1e3;t(ce-b)}catch(m){console.error("Error al decodificar el token:",m),r(m)}else console.error("Error: No se recibi\xF3 `dencryptedToken` en la respuesta."),r("No se recibi\xF3 `dencryptedToken`.")},error:a=>{console.error("Error en la petici\xF3n:",a),r(a)}})})}static \u0275fac=function(t){return new(t||i)(R(S))};static \u0275prov=C({token:i,factory:i.\u0275fac,providedIn:"root"})};var he=()=>["/auth/register"],be=()=>["/forgot-password"];function Ce(i,e){i&1&&(n(0,"span",9),s(1,"El email es necesario."),o())}function xe(i,e){i&1&&(n(0,"span",9),s(1,"El password es necesario."),o())}var A=class i{constructor(e,t,r,a,m){this.fb=e;this.loginService=t;this.router=r;this.toastr=a;this.projects=m;this.loginRegisterForms=this.fb.group({email:["",[g.required,g.email]],password:["",[g.required,g.minLength(8)]]})}email="";password="";loginRegisterForms;page=0;size=0;setToken=x(F);ngOnInit(){this.loginService.usuarioLogeado()&&this.router.navigate(["/"])}onLogin(){let e=T({},this.loginRegisterForms.value);try{this.loginService.login(e.email,e.password).subscribe({next:t=>X(this,null,function*(){try{this.setToken.setExpToken(t.token),this.toastr.success("Login exitoso","Bienvenido!",{timeOut:5e3,positionClass:"toast-top-right"}),this.router.navigate(["/"]).then(()=>{window.location.reload()})}catch{this.toastr.error("Error al procesar el token","Error",{timeOut:5e3,positionClass:"toast-top-right"})}}),error:t=>t})}catch(t){console.error("Error en el login:",t),this.toastr.error("Error en el login","Error",{timeOut:5e3,positionClass:"toast-top-right"});return}}static \u0275fac=function(t){return new(t||i)(c(H),c(ae),c(_),c(j),c(ne))};static \u0275cmp=y({type:i,selectors:[["app-login"]],decls:28,vars:8,consts:[[1,"container",2,"display","grid","grid-template-rows","auto 1fr auto"],[1,"container","d-flex","justify-content-center","align-items-center",2,"height","100vh"],[1,"login-container","p-4","border","rounded","shadow-sm",2,"max-width","400px","width","100%","background-color","#f9f9f9"],["src","images/user-login.jpg","alt","login-image",1,"image-login"],[1,"text-center","mb-4"],[3,"ngSubmit","formGroup"],[1,"form-group","mb-3"],["for","email"],["type","email","id","email","formControlName","email","placeholder","Ingresa tu correo","autocomplete","email","required","",1,"form-control"],[1,"text-danger"],["for","password"],["type","password","id","password","formControlName","password","placeholder","Ingresa tu contrase\xF1a","required","","autocomplete","current-password",1,"form-control"],["type","submit",1,"btn","btn-primary","w-100",3,"disabled"],[1,"forgot-and-register"],[1,"text-center","mt-3"],[3,"routerLink"],[1,"mt-3"]],template:function(t,r){if(t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div"),f(4,"img",3),o(),n(5,"h2",4),s(6,"Iniciar sesi\xF3n"),o(),n(7,"form",5),U("ngSubmit",function(){return r.onLogin()}),n(8,"div",6)(9,"label",7),s(10,"Correo electr\xF3nico"),o(),f(11,"input",8),o(),d(12,Ce,2,0,"span",9),n(13,"div",6)(14,"label",10),s(15,"Contrase\xF1a"),o(),f(16,"input",11),o(),d(17,xe,2,0,"span",9),n(18,"button",12),s(19,"Iniciar sesi\xF3n"),o()(),n(20,"div",13)(21,"div",14),s(22," \xBFNo tienes una cuenta? "),n(23,"a",15),s(24,"Reg\xEDstrate aqu\xED"),o(),n(25,"div",16)(26,"a",15),s(27,"Recuperar contrase\xF1a"),o()()()()()()()),t&2){let a,m;l(7),p("formGroup",r.loginRegisterForms),l(5),u((a=r.loginRegisterForms.get("email"))!=null&&a.invalid&&((a=r.loginRegisterForms.get("email"))!=null&&a.touched)?12:-1),l(5),u((m=r.loginRegisterForms.get("password"))!=null&&m.invalid&&((m=r.loginRegisterForms.get("password"))!=null&&m.touched)?17:-1),l(),p("disabled",r.loginRegisterForms.invalid),l(5),p("routerLink",W(6,he)),l(3),p("routerLink",W(7,be))}},dependencies:[V,D,O,L,N,oe,P,G,E,re],styles:[".login-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:7rem;padding:0;margin-top:-90px;margin-left:120px;border-radius:50%;position:absolute;z-index:1;filter:drop-shadow(0px 0px 5px rgba(0,0,0,.5));transition:all .3s ease;transform:scale(1.1);cursor:pointer;box-shadow:0 0 10px #00000080;transform:scale(1)}.login-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2rem;margin-top:30px;margin-bottom:10px;font-family:Trebuchet MS,Lucida Sans Unicode,Lucida Grande,Lucida Sans,Arial,sans-serif}.login-container[_ngcontent-%COMP%]{height:450px}.forgot-and-register[_ngcontent-%COMP%]{margin-top:30px;justify-content:space-between;align-items:center;gap:10px;width:100%;color:#555;font-size:1.2rem;font-family:Trebuchet MS,Lucida Sans Unicode,Lucida Grande,Lucida Sans,Arial,sans-serif;transition:all .3s ease;transform:translateY(0);cursor:pointer}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-family:Trebuchet MS,Lucida Sans Unicode,Lucida Grande,Lucida Sans,Arial,sans-serif;font-size:1.3rem}"]})};var $=class i{constructor(e){this.http=e}apiUrl=`${w.apiUrl}Auth/register`;registerUser(e){return this.http.post(this.apiUrl,e,{withCredentials:!0})}static \u0275fac=function(t){return new(t||i)(R(S))};static \u0275prov=C({token:i,factory:i.\u0275fac,providedIn:"root"})};function Se(i,e){i&1&&(n(0,"small"),s(1,"El nombre es obligatorio."),o())}function _e(i,e){if(i&1&&(n(0,"div",6),d(1,Se,2,0,"small"),o()),i&2){let t,r=K();l(),u(!((t=r.registerUserFrom.get("name"))==null||t.errors==null)&&t.errors.required?1:-1)}}function we(i,e){i&1&&(n(0,"div",6)(1,"small"),s(2,"El correo electr\xF3nico es obligatorio."),o()())}function Fe(i,e){i&1&&(n(0,"small"),s(1,"La contrase\xF1a es obligatoria."),o())}function Ee(i,e){i&1&&(n(0,"small"),s(1,"Debe tener al menos 8 caracteres."),o())}function Te(i,e){if(i&1&&(n(0,"div",6),d(1,Fe,2,0,"small")(2,Ee,2,0,"small"),o()),i&2){let t,r,a=K();l(),u(!((t=a.registerUserFrom.get("passwordHash"))==null||t.errors==null)&&t.errors.required?1:-1),l(),u(!((r=a.registerUserFrom.get("passwordHash"))==null||r.errors==null)&&r.errors.minlength?2:-1)}}var q=class i{constructor(e,t,r,a){this.fb=e;this.registerUser=t;this.router=r;this.toastr=a;this.registerUserFrom=this.fb.group({name:["",[g.required]],email:["",g.required],passwordHash:["",[g.required,g.minLength(8)]]})}registerUserFrom;formData=new FormData;setToken=x(F);onSbmit(){if(this.registerUserFrom.valid){this.formData=T({id:Math.floor(Math.random()*1e3)},this.registerUserFrom.value);try{this.registerUser.registerUser(this.formData).subscribe({next:e=>{this.setToken.setExpToken(e.token),this.toastr.success("Usuario Registrado con Exito","",{timeOut:5e3,positionClass:"toast-top-right",closeButton:!0,progressBar:!0,tapToDismiss:!0}),setTimeout(()=>{this.router.navigate(["/"])},3e3)}})}catch{this.toastr.error("Todos los campos son obligatorios y la contrase\xF1a debe tener al menos 8 caracteres")}}}static \u0275fac=function(t){return new(t||i)(c(H),c($),c(_),c(j))};static \u0275cmp=y({type:i,selectors:[["app-register"]],decls:21,vars:5,consts:[[1,"container",2,"display","grid","grid-template-rows","auto 1fr auto","min-height","100dvh"],[1,"container","mt-4","p-4","border","rounded","shadow-sm","bg-light",3,"ngSubmit","formGroup"],[1,"text-center","mb-4"],[1,"mb-3"],["for","name",1,"form-label"],["id","name","type","text","formControlName","name",1,"form-control"],[1,"text-danger","small"],["for","email",1,"form-label"],["id","email","type","email","formControlName","email",1,"form-control"],["for","password",1,"form-label"],["id","password","type","password","formControlName","passwordHash",1,"form-control"],["type","submit",1,"btn","btn-primary","w-100",3,"disabled"]],template:function(t,r){if(t&1&&(n(0,"div",0)(1,"form",1),U("ngSubmit",function(){return r.onSbmit()}),n(2,"h2",2),s(3,"Registro de Usuario"),o(),n(4,"div",3)(5,"label",4),s(6,"Nombre:"),o(),f(7,"input",5),d(8,_e,2,1,"div",6),o(),n(9,"div",3)(10,"label",7),s(11,"Correo Electr\xF3nico:"),o(),f(12,"input",8),d(13,we,3,0,"div",6),o(),n(14,"div",3)(15,"label",9),s(16,"Contrase\xF1a:"),o(),f(17,"input",10),d(18,Te,3,2,"div",6),o(),n(19,"button",11),s(20," Registrar "),o()()()),t&2){let a,m,b;l(),p("formGroup",r.registerUserFrom),l(7),u((a=r.registerUserFrom.get("name"))!=null&&a.invalid&&((a=r.registerUserFrom.get("name"))!=null&&a.touched)?8:-1),l(5),u((m=r.registerUserFrom.get("email"))!=null&&m.invalid&&((m=r.registerUserFrom.get("email"))!=null&&m.touched)?13:-1),l(5),u((b=r.registerUserFrom.get("passwordHash"))!=null&&b.invalid&&((b=r.registerUserFrom.get("passwordHash"))!=null&&b.touched)?18:-1),l(),p("disabled",r.registerUserFrom.invalid)}},dependencies:[V,D,O,L,N,P,G],encapsulation:2})};var B=class i{http=x(S);router=new _;baseUrl=`${w.apiUrl}`;constructor(){}getCertificaciones(){let e=`${this.baseUrl}DataProject`;return this.http.get(e,{withCredentials:!0})}static \u0275fac=function(t){return new(t||i)};static \u0275prov=C({token:i,factory:i.\u0275fac,providedIn:"root"})};var Re=(i,e)=>e.id;function Ie(i,e){if(i&1&&(n(0,"div",4)(1,"div",5),f(2,"img",6),n(3,"div",7)(4,"h5",8),s(5),o(),n(6,"p",9),s(7),o(),n(8,"p",9)(9,"a",10),s(10,"Ver m\xE1s"),o()()()()()),i&2){let t=e.$implicit;l(2),te("alt",t.name),p("src",t.imageUrl,Y),l(3),Q(t.name),l(2),Q(t.description),l(2),p("href",t.achievementUrl,Y)}}function Ue(i,e){if(i&1&&(n(0,"div")(1,"div",2),d(2,Ie,11,5,"div",3),o()()),i&2){let t=e.$implicit;l(2),p("ngForOf",t)}}var z=class i{constructor(e){this.certificacionesService=e}certificaciones=[];chunkedCertificaciones=[];ngOnInit(){try{this.certificacionesService.getCertificaciones().subscribe(e=>{this.certificaciones=e.$values,this.chunkedCertificaciones=this.chunkArray(this.certificaciones,4)})}catch(e){console.error("Error al obtener las certificaciones:",e)}}chunkArray(e,t){let r=[];for(let a=0;a<e.length;a+=t)r.push(e.slice(a,a+t));return r}static \u0275fac=function(t){return new(t||i)(c(B))};static \u0275cmp=y({type:i,selectors:[["app-certificaciones"]],decls:5,vars:0,consts:[[1,"container","my-5"],[1,"text-center","mb-4"],[1,"row"],["class","col-lg-3 col-md-4 col-sm-6 mb-4",4,"ngFor","ngForOf"],[1,"col-lg-3","col-md-4","col-sm-6","mb-4"],[1,"card","shadow-sm","card-custom"],[1,"card-img-top",3,"src","alt"],[1,"card-body"],[1,"card-title"],[1,"card-text"],["target","_blank",1,"btn","btn-primary",3,"href"]],template:function(t,r){t&1&&(n(0,"div",0)(1,"h2",1),s(2,"Certificaciones"),o(),Z(3,Ue,3,1,"div",null,Re),o()),t&2&&(l(3),ee(r.chunkedCertificaciones))},dependencies:[M,ie],styles:['@charset "UTF-8";.card-custom[_ngcontent-%COMP%]{height:450px;width:100%;display:flex;flex-direction:column}.card-custom[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column;justify-content:space-between}.card-custom[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{object-fit:cover;height:420px;width:300px;padding:30px;background-color:#f5f5f5;transition:transform .3s ease;transform:scale(1);cursor:pointer}.card-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical}']})};var Me=[{path:"login",component:A},{path:"register",component:q},{path:"certificados",component:z}],J=class i{static \u0275fac=function(t){return new(t||i)};static \u0275mod=I({type:i});static \u0275inj=k({imports:[E.forChild(Me),E]})};var me=class i{static \u0275fac=function(t){return new(t||i)};static \u0275mod=I({type:i});static \u0275inj=k({imports:[M,J]})};export{me as AuthModule};
